<launch>

    <!-- The combination of both local SLAM and GPS SLAM *should* improve the final result and provide some robustness  -->

    <arg name="carname" default="car" />

    <!-- The local SLAM node -->
    <node pkg="locmap_slam" output="screen" type="local_fastslam.py" name="local_fastslam_$(arg carname)" respawn="True">
        # Parameters
        <param name="world_frame" value="ugr/$(arg carname)_odom" />
        <param name="base_link_frame" value="ugr/$(arg carname)_base_link" />

        <param name="fastslam/particle_count" value="50" />
        <rosparam param="fastslam/measurement_covariance">[0.1, 0.0, 0.0, 0.1]</rosparam>
        <rosparam param="fastslam/input_noise">[0.2, 0.2, 0.01, 0.01, 0.001, 0.001]</rosparam>
        <param name="fastslam/threshold_distance" value="5" />
        <param name="max_landmark_range" value="20" />
        <param name="observation_queue_size" value="1"/>

        # Input/output remapping
        <remap from="/input/observations" to="ugr/$(arg carname)/sensors/perception" />
        <remap from="/input/odometry" to="ugr/$(arg carname)/odometry/filtered/odom" />

        <remap from="/output/observations" to="ugr/$(arg carname)/observations/local" />
        <remap from="/output/map" to="ugr/$(arg carname)/map/local" />
        <remap from="/output/odom" to="ugr/$(arg carname)/odometry/slam/local" />
    </node>

    <!-- The global SLAM node -->
    <node pkg="locmap_slam" output="screen" type="global_fastmapping.py" name="global_fastmapping_$(arg carname)" respawn="True">
        # Parameters
        <param name="world_frame" value="ugr/$(arg carname)_map" />
        <param name="base_link_frame" value="ugr/$(arg carname)_base_link" />

        <rosparam param="fastslam/measurement_covariance">[0.1, 0, 0, 0.1]</rosparam>
        <param name="fastslam/threshold_distance" value="5" />
        # Input/output remapping
        <remap from="/input/observations" to="ugr/$(arg carname)/observations/local" />
        <remap from="/input/odometry" to="ugr/$(arg carname)/odometry/filtered/map" />

        <remap from="/output/observations" to="ugr/$(arg carname)/observations/global" />
        <remap from="/output/map" to="ugr/$(arg carname)/map/global" />
        <remap from="/output/odom" to="ugr/$(arg carname)/odometry/slam/global" />

    </node>
</launch>