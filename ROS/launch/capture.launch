<launch>
    <!-- ! Sensor capture files -->

    <!-- ? GPS -->

    <node pkg="pepwave_gps" type="gps.py" name="publish_gps" output="screen">
        <param name="ip_address" value="192.168.50.1" />
        <param name="port" value="60660" />
        <param name="gps_frame" value="ugr/car_base_link/gps/pepwave" />
        <param name="use_gps_time" value="False" />

        <remap from="/output/gps" to="/ugr/car/sensors/gps/pepwave" />
    </node>


    <!-- USB-C (gsp vanboven) is links -->
    <!-- USB A (gps vanonder) is rechts -->

    <!-- ! RIGHT -->
    <node pkg="ublox_gps" type="ntripclient" name="ntripclient_right" output="screen">
        <param name="server" value="euref-ip.be" />
        <param name="mountpoint" value="BRUX00BEL0" />
        <param name="port" value="2101" />
        <param name="user" value="UGentRacing" />
        <param name="password" value="UGentRacing" />
        <param name="baudrate" value="921600" />
        <param name="device" value="/dev/ttyUSB1" />
    </node>
    <node pkg="nmea_navsat_driver" output="log" type="nmea_serial_driver" name="nmea_publisher_right">
        <param name="port" value="/dev/ttyUSB1"></param>
        <param name="baud" value="921600"></param>

        <param name="frame_id" value="ugr/car_base_link/gps/ublox/right" />
        <remap from="/fix" to="/ugr/car/sensors/gps/ublox/right" />
        <remap from="/vel" to="/ugr/car/sensors/gps/ublox/right/vel" />
    </node>

    <!-- ! LEFT -->

    <node pkg="ublox_gps" type="ntripclient" name="ntripclient_left" output="screen">
        <param name="server" value="euref-ip.be" />
        <param name="mountpoint" value="BRUX00BEL0" />
        <param name="port" value="2101" />
        <param name="user" value="UGentRacing" />
        <param name="password" value="UGentRacing" />
        <param name="baudrate" value="921600" />
        <param name="device" value="/dev/ttyUSB0" />
    </node>
    <node pkg="nmea_navsat_driver" output="log" type="nmea_serial_driver" name="nmea_publisher_left">
        <param name="port" value="/dev/ttyUSB0"></param>
        <param name="baud" value="921600"></param>

        <param name="frame_id" value="ugr/car_base_link/gps/ublox/left" />
        <remap from="/fix" to="/ugr/car/sensors/gps/ublox/left" />
        <remap from="/vel" to="/ugr/car/sensors/gps/ublox/left/vel" />
    </node>

    <!-- ? Heading estimation -->

    <include file="$(find ublox_gps)/launch/estimate_heading.launch">
        <arg name="rate" default="20" />
        <arg name="max_time_deviation" default="0.01" />
        <arg name="base_link_frame" default="ugr/car_base_link" />
    </include>

    <!-- ? Lidar -->

    <include file="$(find ouster_ros)/ouster.launch">
        <arg name="imu_topic" value="/ugr/car/sensors/imu/ouster" />
        <arg name="lidar_topic" value="/ugr/car/sensors/lidar" />
    </include>

    <!-- ? CAN -->

    <node pkg="can_node" type="can_converter.py" name="can_converter" output="screen">
        <param name="interface" value="can0" />
        <param name="baudrate" value="250000" />
        <param name="odrive_dbc" value="$(find can_node)/odrive.dbc" />
        <param name="imu/front/frame" value="ugr/car_base_link/imu0" />
        <param name="imu/front/back" value="ugr/car_base_link/imu1" />

        <remap from="/output/can" to="/can_messages" />
        <remap from="/output/vel0" to="/ugr/car/sensors/encoder0" />
        <remap from="/output/vel1" to="/ugr/car/sensors/encoder1" />
        <remap from="/output/start" to="/control/start" />
        <remap from="/output/stop" to="/control/stop" />


        <!-- IMU0 : front -->
        <remap from="/output/imu0/pitch_roll" to="/ugr/car/sensors/imu0/pitch_roll" />
        <remap from="/output/imu0/angular_rate" to="/ugr/car/sensors/imu0/angular_rate" />
        <remap from="/output/imu0/acc" to="/ugr/car/sensors/imu0/acc" />

        <!-- IMU1 : back -->
        <remap from="/output/imu1/pitch_roll" to="/ugr/car/sensors/imu1/yaw_roll" />
        <remap from="/output/imu1/angular_rate" to="/ugr/car/sensors/imu1/angular_rate" />
        <remap from="/output/imu1/acc" to="/ugr/car/sensors/imu1/acc" />

    </node>

    <!-- Camera -->
    <env name="BINARY_LOCATION" value="$(env HOME)/autonomous2023_binaries" />

    <include file="$(find camera)/launch/perception.camera.publisher.launch">
        <arg name="type" value="camera"/>
    </include>
</launch>
